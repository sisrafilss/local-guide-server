model Booking {
  id          String        @id @default(uuid())
  listingId   String
  touristId   String
  guideId     String
  requestedAt DateTime      @default(now())
  startAt     DateTime
  endAt       DateTime?
  status      BookingStatus @default(PENDING)
  totalPrice  Decimal       @db.Decimal(10, 2)
  pax         Int           @default(1)
  notes       String?

  listing Listing  @relation(fields: [listingId], references: [id])
  tourist Tourist  @relation(fields: [touristId], references: [id])
  guide   Guide    @relation(fields: [guideId], references: [id])
  payment Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  reviews   Review[]
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?

  @@map("bookings")
}

model Review {
  id         String   @id @default(uuid())
  listingId  String?
  bookingId  String?
  reviewerId String
  rating     Int      @default(5)
  comment    String?
  createdAt  DateTime @default(now())

  listing  Listing? @relation(fields: [listingId], references: [id])
  booking  Booking? @relation(fields: [bookingId], references: [id])
  reviewer User     @relation(fields: [reviewerId], references: [id])

  @@map("reviews")
}

model Payment {
  id          String         @id @default(uuid())
  bookingId   String         @unique
  amount      Decimal        @db.Decimal(10, 2)
  currency    String         @default("USD")
  gateway     PaymentGateway
  gatewayTxId String?
  status      PaymentStatus  @default(INITIATED)
  metadata    Json?

  booking Booking @relation(fields: [bookingId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}
